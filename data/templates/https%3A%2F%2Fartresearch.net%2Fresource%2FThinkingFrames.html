<ol class="page-breadcrumb">
  <li>
    <a title="Home" href="/resource/start">Home</a>
  </li>
  [[#if (urlParam "previousPage")]]
  <li>
    <semantic-link iri='[[urlParam "previousPage"]]'>
      [[urlParam "previousPageTitle"]]
    </semantic-link>
  </li>
  [[/if]]
  <li class="active">
    Thinking Frames
  </li>
</ol>

<style>
  .ontodia-overlayed-element  {
    min-height: 234px;
    min-width: 185px;
  }
</style>

<mp-event-proxy
  id='clipboard-update-on-create-set'
	on-event-type='Components.SetManagement.SetAdded'
  proxy-event-type='Component.Refresh'
  proxy-targets='["clipboard"]'>
</mp-event-proxy>

<mp-event-proxy id='clipboard-update-on-save-search' on-event-source='save-search-result-action'
                proxy-event-type='Component.Refresh' proxy-targets='["clipboard"]'
></mp-event-proxy>

<mp-event-proxy id='clipboard-update-on-persisted-component' on-event-source='persit-component-action'
                proxy-event-type='Component.Refresh' proxy-targets='["clipboard"]'
></mp-event-proxy>


<div class='page thinking-frames-page'>
  [[#>Default:DetailsSidebar]]
  <rs-dashboard
    [[#if (urlParam "view")]]
      initial-view='{"view": "[[urlParam "view"]]", "resource": "[[urlParam "resource"]]"}'            
    [[/if]] 
    [[#if view]]
      initial-view='{"view": "[[view]]", "resource": "[[resource]]"}'            
    [[/if]] 
                
    views='[{
    	"id": "resource",
      "label": "Resource",
      "description": "View resource details",
      "image": "/images/icons/pages.svg",
      "template": "{{> resourceTemplate}}"
    },{
    	"id": "knowledge-map",
      "label": "Knowledge Map",
      "description": "Express research thinking and processes as networks of relations",
      "image": "/images/icons/diagram_dark.svg",
      "iconClass": "fa fa-object-group",
      "template": "{{> ontodiaTemplate}}",
      "itemBodyTemplate": "{{> itemBodyTemplate}}",
      "resourceNotRequired": true,
      "frameVariable": "ontodiaVariable"
    }, {
    	"id": "semantic-narrative",
      "label": "Semantic Narrative",
      "description": "Compose and share your research through as evolving narrative",
      "image": "/images/icons/narrative_dark.svg",
      "iconClass": "fa fa-file-text-o",
      "template": "{{> semanticNarrativeTemplate}}",
      "itemBodyTemplate": "{{> itemBodyTemplate}}",
      "resourceNotRequired": true,
      "frameVariable": "narrativeVariable",
      "checkQuery": "ASK { ?value a rso:Semantic_Narrative . }"
    },
    {
    	"id": "iiif",
      "label": "Image Viewer",
      "description": "View and compare High-Resolution images",
      "image": "/images/icons/images_dark.svg",
      "iconClass": "fa fa-picture-o",
      "template": "{{> iiifTemplate}}",
      "frameVariable": "miradorVariable"
    },
    {
    	"id": "simple-search",
      "label": "Search",
      "description": "Search for resources",
      "image": "/images/icons/semantic_search_dark.svg",
      "iconClass": "fa fa-search",
      "checkQuery": "ASK { ?value a rso:Semantic_Search . }",
      "template": "{{> simpleSearchTemplate}}",
      "resourceNotRequired": true
    }
    ]'
                
    linked-views='[{
      "id": "image-graph-authoring",
      "label": "Image Graph Authoring",
      "description": "Knowledge Map + IIIF Image Viewer",
      "image": "/images/icons/image_annotation_dark2.svg",
      "iconClass": "fa fa-file-image-o",
      "viewIds": ["knowledge-map", "iiif"],
      "resourceNotRequired": true,
      "checkQuery": "ASK { FILTER NOT EXISTS { ?value a <http://www.metaphacts.com/ontologies/platform#Set>       } }"
    }]' 
    >
    [[>Default:Clipboard id="clipboard" defaultViewMode="grid"]]
    <template id='resourceTemplate'>
      <div style='flex: 1 1 0px; overflow: auto;'>
        <mp-page-loader urlqueryparam-frame=true iri='{{iri}}' context='{{iri}}'>
        </mp-page-loader>
    	</div>
    </template>
    <template id='simpleSearchTemplate'>
      <div class='rs-search-page' style='flex: 1 1 0px; overflow: auto; padding:25px 20px;'>
        <mp-page-loader urlqueryparam-frame=true iri='http://www.researchspace.org/resource/SearchContent'>
        </mp-page-loader>
    	</div>
    </template>
    <template id='ontodiaTemplate'>
      [[>Default:ThinkingFramesKnowledgeMapTemplate]]
    </template>
    <template id='iiifTemplate'>
      [[>Default:ThinkingFramesIIIFTemplate]]
    </template>
    <template id='semanticNarrativeTemplate'>
      [[>Default:ThinkingFramesSemanticNarrativeTemplate]]
    </template>
    <template id='itemBodyTemplate'>
      <ontodia-contents id='{{dashboardId}}-ontodia' template='{{> template}}'>
        <div>
          <button name='submit' className='btn btn-default btn-xs'>
            Create Set
          </button>&nbsp;
          <mp-popover>
            <mp-popover-trigger placement="right" trigger='["click","hover","focus"]' root-close='false'>
              <small><i class='fa fa-question-circle'></i></small>
            </mp-popover-trigger>
            <mp-popover-content>Only persisted data will be saved to a set</mp-popover-content>
          </mp-popover>
        </div>
        <template id='template'>
        {{log "sidebar" this}}
          {{#ifCond persisted "==" true}}
            <span class='set-management__set-item' style='padding: 10px'>
              {{#bind iri=iri.value}}
              {{>Default:itemCardTemplate width=135 height=175 footer-paddingY=7 footer-paddingX=8}}
              {{/bind}}
            </span>
            {{else}}
            <span class='set-management__set-item' style='opacity: 0.4; padding: 10px'>
              {{#bind iri=iri.value}}
                {{>Default:itemCardTemplate width=135 height=175 }}
              {{/bind}}          
            </span>
          {{/ifCond}}
        </template>
      </ontodia-contents>
    </template>
  </rs-dashboard>
  [[/Default:DetailsSidebar]]
</div>