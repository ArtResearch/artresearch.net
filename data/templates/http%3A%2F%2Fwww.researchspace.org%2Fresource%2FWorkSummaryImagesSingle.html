<div
class="rs-page__summary-image summaryImages summary-image-with-thumbs"
>
<mp-event-target-template-render
  id="event-target"
  template="{{> mainImageTemplate}}"
>
  <template id="mainImageTemplate">
    <mp-overlay-dialog title="‎‎" type="lightbox">
      <mp-overlay-dialog-trigger>
        <div class="summary-image-main imageAndSourceContainer">  
          {{#ifCond imgURL "!==" undefined}}
          <semantic-query
            query='     
          SELECT ?providerLabel WHERE{    
            ?photo crm:P129i_is_subject_of ?image.
            ?photo <https://pharos.artresearch.net/custom/has_provider> ?provider.
            ?provider rdfs:label ?providerLabel.
            BIND(IRI(REPLACE(STR("{{imgURL}}"),"full/!350,350","full/full")) AS ?image)
          }limit 1
            '
            template="{{> imageSourceIcon}}"
          >
            <template id="imageSourceIcon">
              <div class="imageSourceIcon fade-in">
                <img
                  title="{{bindings.0.providerLabel.value}}"
                  class="sourceIcon"
                  src="../../assets/images/{{bindings.0.providerLabel.value}}.ico"
                />
              </div>
            </template>
          </semantic-query>
          <semantic-query
            query='SELECT ?images WHERE{
              ?photo crm:P129i_is_subject_of ?imgURL; 
              crm:P129i_is_subject_of ?rectoVerso.
              ?rectoVerso crm:P2_has_type ?type.
              ?type rdfs:label ?typeLabel.
              FILTER(?typeLabel = "verso" || ?typeLabel = "recto"  )  
              BIND(IRI(REPLACE(STR("{{imgURL}}"),"full/!350,350","full/full")) AS ?imgURL)
              BIND(REPLACE(STR(?rectoVerso), "full/full", "full/!350,350") AS ?images)
          }ORDER BY ASC(?typeLabel)'
            template="{{>rectoVerso}}"
          >
            <template id="rectoVerso">
              {{#each bindings}}
              <img
                class="imageThumbnailSingle"
                alt="Issue with image provider"
                src="{{images.value}}"
              />
              {{/each}}
            </template>
          </semantic-query>
          {{/ifCond}} {{#ifCond imgURL "===" undefined}}
          <semantic-query
            query='SELECT DISTINCT ?iiifImage ?images WHERE{
              BIND(("{{bindings.0.imgURL.value}}") AS ?imageUrl).
              ?photo crm:P129i_is_subject_of ?iiifImage;
              crm:P129i_is_subject_of ?rectoVerso.
              ?rectoVerso crm:P2_has_type ?type.
              ?type rdfs:label ?typeLabel.
              FILTER(?typeLabel = "verso" || ?typeLabel = "recto"  )  
              BIND(iri(REPLACE(STR("{{bindings.0.imgURL.value}}"),"full/!350,350","full/full")) AS ?iiifImage).
              BIND(REPLACE(STR(?rectoVerso), "full/full", "full/!350,350") AS ?images)
            }ORDER BY ASC(?typeLabel)'
            template="{{> mediumImageSize}}"
          >
            <template id="mediumImageSize">
              <semantic-query
                query="     
                SELECT ?providerLabel WHERE{    
                  ?photo crm:P129i_is_subject_of <{{bindings.0.iiifImage.value}}>.
                  ?photo <https://pharos.artresearch.net/custom/has_provider> ?provider.
                  ?provider rdfs:label ?providerLabel.
                }limit 1
                "
                template="{{> imageSourceIcon}}"
              >
                <template id="imageSourceIcon">
                  <div class="imageSourceIcon fade-in">
                    <img
                      title="{{bindings.0.providerLabel.value}}"
                      class="sourceIcon"
                      src="../../assets/images/{{bindings.0.providerLabel.value}}.ico"
                    />
                  </div>
                </template>
              </semantic-query>
                {{#each bindings}}
                <img
                  class="imageThumbnailSingle"
                  alt="Issue with image provider"
                  src="{{images.value}}"
                />
                {{/each}}
            </template>
          </semantic-query>
          {{/ifCond}}
        </div>
      </mp-overlay-dialog-trigger>
      <mp-overlay-dialog-content>
         {{#ifCond  bindings.0.iiifServer.value "!==" undefined}}
            [[> :WorkSummaryImagesSingleIIIFModal iiifServer="{{bindings.0.iiifServer.value}}"]]
          {{else}}
            [[> :WorkSummaryImagesSingleImageModal]]
          {{/ifCond}}
      </mp-overlay-dialog-content>
    </mp-overlay-dialog>
  </template>
</mp-event-target-template-render>
<div class="summary-image-thumbs">
  {{#ifCond (objectLength bindings) ">" 1 }}
    {{#each bindings}}
    <semantic-query
      query='
    SELECT DISTINCT ?imgURL WHERE{ 
        BIND(({{image}}) as ?imgURL)
        FILTER NOT EXISTS { 
          ?imgURL crm:P2_has_type ?type.
          ?type rdfs:label "verso"
        }
      } '
      template="{{> onlyRectos}}"
    >
      <template id="onlyRectos">
        <mp-event-trigger
          id="event-trigger"
          type="Component.TemplateUpdate"
          data='{"imgURL":"{{imgURL.value}}"}'
          targets='["event-target"]'
        >
          <img
            class="object-representations__image--rep smallThumbsSingle"
            src="{{imgURL.value}}"
          />
        </mp-event-trigger>
      </template>
    </semantic-query>
    {{/each}}
  {{/ifCond}}
</div>
</div>