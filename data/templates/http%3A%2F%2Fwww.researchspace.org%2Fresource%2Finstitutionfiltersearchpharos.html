<div id="institution-filter-search">
<semantic-search
  relations='{
    "<https://pharos.artresearch.net/resource/field/Artist_Attribution>":[
    {
      "kind": "resource",
      "queryPattern": "
        
          $subject <https://pharos.artresearch.net/resource/fr/Work_created_from_Artist> ?__value__."
    }
],
    "<https://pharos.artresearch.net/fieldDefinition/Repository>":[
    {
      "kind": "resource",
      "queryPattern": "
        
          $subject <https://pharos.artresearch.net/resource/fr/Work_kept_by_Institution> ?__value__."
    }],
    "<https://pharos.artresearch.net/fieldDefinition/46>": [
    {
      "kind": "resource",
      "queryPattern": "
        
          $subject <https://pharos.artresearch.net/resource/fr/Work_shows_Subject>  ?__value__."
    }],
    "<https://pharos.artresearch.net/fieldDefinition/44>": [
    {
      "kind": "resource",
      "queryPattern": "
        
          $subject <https://pharos.artresearch.net/resource/fr/Work_consists_of_Material> ?__value__."
    }],
    "<https://pharos.artresearch.net/fieldDefinition/550>": [
    {
      "kind": "resource",
      "queryPattern": "
        
          $subject <http://www.cidoc-crm.org/cidoc-crm/P2_has_type> ?__value__ ."
    }],
    "<https://pharos.artresearch.net/fieldDefinition/42>": [
    {
      "kind": "resource",
      "queryPattern": "
        
         $subject <https://pharos.artresearch.net/resource/fr/Work_produced_using_technique_Technique> ?__value__."
    }],
    "<https://pharos.artresearch.net/fieldDefinition/93>": [
    {
      "kind": "resource",
      "queryPattern": "
        
          $subject <https://pharos.artresearch.net/resource/fr/Work_from_Place> ?__value__."
    }]
      }'
  search-profile='{
        "categories":  
        [
          {
            "iri":"<http://www.cidoc-crm.org/cidoc-crm/E21_Person>",
            "label":"Painter"
          },
          {
            "iri":"<http://www.cidoc-crm.org/cidoc-crm/E39_Actor>",
            "label":"Creator"
          },
          {
            "iri":"<http://www.cidoc-crm.org/cidoc-crm/E22_Man-Made_Object>",
            "label":"Artwork"
          },
          {
            "iri":"<http://www.cidoc-crm.org/cidoc-crm/E55_Type>",
            "label":"Concept"
          }, 
          {
            "iri":"<http://www.cidoc-crm.org/cidoc-crm/E57_Material>",
            "label":"Material"
          }, 
          {
            "iri":"<http://www.cidoc-crm.org/cidoc-crm/E29_Design_or_Procedure>",
            "label":"Technique"
          }, 
          {
            "iri":"<http://www.cidoc-crm.org/cidoc-crm/E53_Place>",
            "label":"Location"
          }
        ],
        "relations":
        [
          {
            "iri": "<https://florentinedrawings.itatti.harvard.edu/resource/field/Artist_Attribution>",
            "label":"Creator",
            "hasDomain":"<http://www.cidoc-crm.org/cidoc-crm/E22_Man-Made_Object>",
            "hasRange":"<http://www.cidoc-crm.org/cidoc-crm/E21_Person>"
          },
          {
            "iri": "<https://pharos.artresearch.net/fieldDefinition/Repository>",
            "label":"Repository",
            "hasDomain":"<http://www.cidoc-crm.org/cidoc-crm/E22_Man-Made_Object>",
            "hasRange":"<http://www.cidoc-crm.org/cidoc-crm/E39_Actor>"
          },
          {
            "iri":"<https://pharos.artresearch.net/fieldDefinition/46>",
            "label":"Subject",
            "hasDomain":"<http://www.cidoc-crm.org/cidoc-crm/E22_Man-Made_Object>",
            "hasRange":"<http://www.cidoc-crm.org/cidoc-crm/E55_Type>"
          },
          {
            "iri":"<https://pharos.artresearch.net/fieldDefinition/44>",
            "label":"Material",
            "hasDomain":"<http://www.cidoc-crm.org/cidoc-crm/E22_Man-Made_Object>",
            "hasRange":"<http://www.cidoc-crm.org/cidoc-crm/E57_Material>"
          },
          {
            "iri":"<https://pharos.artresearch.net/fieldDefinition/550>",
            "label":"Concept",
            "hasDomain":"<http://www.cidoc-crm.org/cidoc-crm/E22_Man-Made_Object>",
            "hasRange":"<http://www.cidoc-crm.org/cidoc-crm/E55_Type>"
          },
          {
            "iri":"<https://pharos.artresearch.net/fieldDefinition/42>",
            "label":"Technique",
            "hasDomain":"<http://www.cidoc-crm.org/cidoc-crm/E22_Man-Made_Object>",
            "hasRange":"<http://www.cidoc-crm.org/cidoc-crm/E29_Design_or_Procedure>"
          },
          {
            "iri":"<https://pharos.artresearch.net/fieldDefinition/93>",
            "label":"Location",
            "hasDomain":"<http://www.cidoc-crm.org/cidoc-crm/E22_Man-Made_Object>",
            "hasRange":"<http://www.cidoc-crm.org/cidoc-crm/E53_Place>"
          }
        ]
      }'
>
  <div id="header-search" class="search-page">
    <semantic-form
      new-subject-template="http://www.example.com/switch/actions/{{UUID}}"
      post-action="redirect"
      browser-persistence="true"
      form-id="example-8"
      fields='[
          {
            "id": "switch-action-type",
            "label": "Switch",
            "description": "Allows to select different forms",
            "xsdDatatype": "xsd:anyURI",
            "selectPattern": "SELECT $value WHERE { $subject <http://www.example.com/switch/has-action> $value }",
            "insertPattern": "INSERT { $subject <http://www.example.com/switch/has-action> $value } WHERE {}",
            "deletePattern": "DELETE { $subject <http://www.example.com/switch/has-action> $value } WHERE {}"
          }
        ]'
    >
      <semantic-form-switch
        for="switch-action-type"
        switch-on-field="switch-case-type"
      >
        <semantic-form-switch-case label="Repository">
          <semantic-form-composite-input
            for="switch-action-type"
            new-subject-template="http://www.example.com/switch/action/artist"
            fields='[
                {
                  "id": "switch-case-type",
                  "xsdDatatype": "xsd:anyURI",
                  "minOccurs": "1",
                  "maxOccurs": "1",
                  "selectPattern": "SELECT ?value WHERE { $subject <http://www.example.com/switch/has-action-type> ?value }",
                  "insertPattern": "INSERT { $subject <http://www.example.com/switch/has-action-type> ?value } WHERE {}",
                  "deletePattern": "DELETE { $subject <http://www.example.com/switch/has-action-type> ?value } WHERE {}"
                }
              ]'
          >
            <semantic-form-hidden-input
              for="switch-case-type"
              default-value="http://www.example.com/switch/type/move"
            >
            </semantic-form-hidden-input>

            <semantic-search-query-keyword
              placeholder="Search for a repository e.g. Royal Library"
              escape-lucene-syntax="false"
              domain="<http://www.cidoc-crm.org/cidoc-crm/E39_Actor>"
              default-query="
              SELECT DISTINCT ?subject  
              WHERE {
                ?subject a <https://pharos.artresearch.net/resource/fc/institution>.        
              }LIMIT 100"
              query='
                      SELECT DISTINCT ?subject WHERE {
                      ?subject a <https://pharos.artresearch.net/resource/fc/institution>.      
                      ?subject rdfs:label ?someLabel.
                      ?someLabel bds:search ?__token__ .
                      ?someLabel bds:minRelevance "0.3"^^xsd:double;
                      bds:matchAllTerms "true"  .
                      
                      } 
                    '
            ></semantic-search-query-keyword>
          </semantic-form-composite-input>
        </semantic-form-switch-case>
      </semantic-form-switch>
    </semantic-form>
  </div>

  <div class="row">
    <!-- <bs-col
      lg="3"
      md="4"
      sm="5"
      class="fade-in-fwd filters-container"
      style="margin-top: 8px"
    >
      <div class="filter-title">Filters</div>
      <semantic-search-facet open-by-default="true"></semantic-search-facet>
    </bs-col> -->
    <bs-col lg="12">
      <semantic-search-result-holder>
        <bs-tabs unmount-on-exit="true" id="search-results" animation="false">
          <bs-tab event-key="2" title="Grid">
            <semantic-search-result>
              <semantic-table
                id="grid-result"
                options='{
                      "showFilter":false
                    }'
                number-of-displayed-rows="12"
                query='
                  SELECT DISTINCT ?subject ?institutionName ?placeLabel
                   WHERE {
                    ?subject rdfs:label ?name.
                    ?subject <https://pharos.artresearch.net/resource/fr/Institution_from_Place> ?place.
                    ?place rdfs:label ?placeLabel.
										BIND(REPLACE(STR(?name),"@en","") AS ?institutionName).
                   }LIMIT 100
                '
                tuple-template="{{>tupleTemplate}}"
              >
                <template id="tupleTemplate"
                          >

                  <div
                    class="rs-grid-element panel panel-default artwork-card fade-in-fwd"
                  >
                    <semantic-link iri="{{subject.value}}">

                      <div class="panel-body">
                        <bs-col
                          class="thumbnailImageContainer"
                          lg="4"
                          md="12"
                          xs="12"
                        >

                          <!-- Thumbnail for Institution (fetch from wikidata (good luck)) -->
                            <semantic-query
                            query='
                          PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
                          PREFIX wd: <http://www.wikidata.org/entity/>
                          PREFIX wdt: <http://www.wikidata.org/prop/direct/>
													PREFIX wdtn: <http://www.wikidata.org/prop/direct-normalized/>

                          SELECT DISTINCT ?imgUrl WHERE{
                            bind("_" as ?default_imageUrl)
                            OPTIONAL{
                              SERVICE <https://query.wikidata.org/sparql> 
                                {
                                  {
                                    ?institution wdt:P31 wd:Q33506 . 
                                    ?institution rdfs:label "{{institutionName.value}}"@en .
                                    ?institution wdt:P18 ?institutionImage
                                  }UNION{
                                    ?institution wdt:P31 wd:Q207694.
                                    ?institution rdfs:label "{{institutionName.value}}"@en .
                                    ?institution wdt:P18 ?institutionImage.
                                  } UNION {
                                      ?person wdtn:P245 <{{subject.value}}>.
                                      ?person wdt:P18 ?personImage.
                                    }
                                }
                            }
                            BIND(coalesce(?institutionImage, ?default_imageUrl) as ?imgUrl)    
                                }LIMIT 1'
                            template="{{> imageThumbnail}}"
                          >
                            <template id="imageThumbnail">
                              <img
                                alt="   "
                                class="thumbnailImage"
                                src="{{bindings.0.imgUrl.value}}"
                              />
                            </template>
                        </semantic-query>
                        </bs-col>
                        <bs-col class="cardInfo" lg="12">
                          <div data-flex-layout="row md-column center-stretch">
                            <bs-row class="cardInfoFields">
                              <h4>
                                <semantic-link
                                  iri="{{subject.value}}"
                                ></semantic-link>
                     
                              </h4>
                              <small>
                                {{placeLabel.value}}
                              </small>
                            </bs-row>
                          </div>
                        </bs-col>
                      </div>

                    </semantic-link>
                  </div>

                  </template>
              </semantic-table>
            </semantic-search-result>
          </bs-tab>
        </bs-tabs>
      </semantic-search-result-holder>
    </bs-col>
  </div>
</semantic-search>
</div>