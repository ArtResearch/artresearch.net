<div
class="rs-page__summary-image summaryImages summary-image-with-thumbs"
>
<mp-event-target-template-render
  id="event-target"
  template="{{> mainImageTemplate}}"
>
  <template id="mainImageTemplate">
    <mp-overlay-dialog title="‎‎" type="lightbox">
      <mp-overlay-dialog-trigger>
        <div class="summary-image-main imageAndSourceContainer">
          {{#ifCond imgURL "!==" undefined}}
          <semantic-query
            query='     
          SELECT ?providerLabel WHERE{    
            ?photo crm:P129i_is_subject_of ?image.
            ?photo <https://pharos.artresearch.net/custom/has_provider> ?provider.
            ?provider rdfs:label ?providerLabel.
            BIND(IRI(REPLACE(STR("{{imgURL}}"),"full/350,","full/full")) AS ?image)
          }limit 1
            '
            template="{{> imageSourceIcon}}"
          >
            <template id="imageSourceIcon">
              <div class="imageSourceIcon fade-in">
                <img
                  title="{{bindings.0.providerLabel.value}}"
                  class="sourceIcon"
                  src="../../assets/images/{{bindings.0.providerLabel.value}}.ico"
                />
              </div>
            </template>
          </semantic-query>
          <semantic-query
            query='SELECT ?images WHERE{
              BIND(IRI(REPLACE(STR("{{imgURL}}"),"full/350,","full/full")) AS ?imgURL).
              ?photo crm:P129i_is_subject_of ?imgURL; 
              crm:P129i_is_subject_of ?rectoVerso;
              BIND(REPLACE(STR(?rectoVerso), "full/full", "full/350,") AS ?images)
          }'
            template="{{>rectoVerso}}"
          >
            <template id="rectoVerso">
              {{#each bindings}}
              <img
                class="imageThumbnailSingle"
                alt="Issue with image provider"
                src="{{images.value}}"
              />
              {{/each}}
            </template>
          </semantic-query>
          {{/ifCond}} {{#ifCond imgURL "===" undefined}}
          <semantic-query
            query='SELECT DISTINCT ?iiifImage ?images WHERE{
                BIND(iri(REPLACE(STR("{{bindings.0.imgURL.value}}"),"full/350,","full/full")) AS ?iiifImage).
                BIND(("{{bindings.0.imgURL.value}}") AS ?imageUrl).
                ?photo crm:P129i_is_subject_of ?iiifImage;
                      crm:P129i_is_subject_of ?rectoVerso.
                BIND(REPLACE(STR(?rectoVerso), "full/full", "full/350,") AS ?images)   
                }'
            template="{{> mediumImageSize}}"
          >
            <template id="mediumImageSize">
              <semantic-query
                query="     
                SELECT ?providerLabel WHERE{    
                  ?photo crm:P129i_is_subject_of <{{bindings.0.iiifImage.value}}>.
                  ?photo <https://pharos.artresearch.net/custom/has_provider> ?provider.
                  ?provider rdfs:label ?providerLabel.
                }limit 1
                "
                template="{{> imageSourceIcon}}"
              >
                <template id="imageSourceIcon">
                  <div class="imageSourceIcon fade-in">
                    <img
                      title="{{bindings.0.providerLabel.value}}"
                      class="sourceIcon"
                      src="../../assets/images/{{bindings.0.providerLabel.value}}.ico"
                    />
                  </div>
                </template>
              </semantic-query>
              {{#each bindings}}
              <img
                class="imageThumbnailSingle"
                alt="Issue with image provider"
                src="{{images.value}}"
              />
              {{/each}}
            </template>
          </semantic-query>
          {{/ifCond}}
        </div>
      </mp-overlay-dialog-trigger>
      <mp-overlay-dialog-content>
        <semantic-query
          query='SELECT ?fullsizeImages ?iiifServer WHERE {
                { 
                  ??  <https://pharos.artresearch.net/custom/has_provider> ?provider.
                  ?provider <https://pharos.artresearch.net/custom/has_iiif_server> ?iiifServer.
                }UNION{
                  ?originalSubject owl:sameAs ??.
                  ?originalSubject  <https://pharos.artresearch.net/custom/has_provider> ?provider.
                  ?provider <https://pharos.artresearch.net/custom/has_iiif_server> ?iiifServer.
                }
                {{#ifCond imgURL "!==" undefined}}
                {
                  BIND(REPLACE(STR("{{imgURL}}"),"full/350,","full/full") AS ?fullsizeImgUrl).
                  BIND(iri(?fullsizeImgUrl) AS ?fullsizeImgUrlIri).
                  ?photo crm:P129i_is_subject_of ?fullsizeImgUrlIri;
                         crm:P129i_is_subject_of ?fullsizeImages.
                }UNION{
                  # For Hertziana (non-iiif)
                  ?photo crm:P129i_is_subject_of <{{imgURL}}>;
                         crm:P129i_is_subject_of ?fullsize.
                  BIND(REPLACE(STR(?fullsize),"320px","2048px") AS ?fullsizeImages)
                }
                {{/ifCond}}
                {{#ifCond imgURL "===" undefined}}
                {
                  BIND(REPLACE(STR("{{bindings.0.imgURL.value}}"),"full/350,","full/full") AS ?fullsizeImgUrl).
                  BIND(iri(?fullsizeImgUrl) AS ?fullsizeImgUrlIri).
                  ?photo crm:P129i_is_subject_of ?fullsizeImgUrlIri;
                         crm:P129i_is_subject_of ?fullsizeImages.
                }UNION{
                  # For Hertziana (non-iiif)
                  ?photo crm:P129i_is_subject_of <{{bindings.0.imgURL.value}}>;
                         crm:P129i_is_subject_of ?fullsize.
                  BIND(REPLACE(STR(?fullsize),"320px","2048px") AS ?fullsizeImages)
                }
                {{/ifCond}}
            }LIMIT 2'
          template="{{> fullSizeImageTemplate}}"
        >
          <template id="fullSizeImageTemplate">
            {{#ifCond bindings.0.iiifServer.value "!==" undefined}}
            <div>
              {{#ifCond (objectLength bindings) "===" 1}}
              <div style="width: 100vw; height: 86vh">
                <rs-iiif-mirador
                  image-or-region="[[this]]"
                  image-id-pattern='
                            BIND("image" AS ?type). BIND(?subject AS ?imageIRI). 
                            ?subject <https://pharos.artresearch.net/resource/fr/Work_depicted_by_Photo> ?photo.
                            ?photo crm:P129i_is_subject_of <{{bindings.0.fullsizeImages.value}}>.
                            <{{bindings.0.fullsizeImages.value}}> crm:P2_has_type <http://iiif.io/api/image>.
                            BIND(REPLACE(STR("{{bindings.0.fullsizeImages.value}}"), "full/!700,700", "full/full") AS ?fotoIndexId).
                            BIND(REPLACE(STR(REPLACE(STR(?fotoIndexId), "/full/full/0/*", "")), "(^.*)\\/(.*)$", "$2") AS ?idWithDefaultNative)      BIND(REPLACE(?idWithDefaultNative,"default.jpg","") AS ?idWithNative).
                            BIND(REPLACE(?idWithNative,"native.jpg","") AS ?imageID).
                            '
                  iiif-server-url="{{bindings.0.iiifServer.value}}"
                >
                </rs-iiif-mirador>
              </div>
              {{else}}
              <div class="rectoVersoMirador">
                <div style="width: 50vw; height: 86vh">
                  <rs-iiif-mirador
                    id="rectoMirador"
                    image-or-region="[[this]]"
                    image-id-pattern='
                                BIND("image" AS ?type). BIND(?subject AS ?imageIRI). 
                                ?subject <https://pharos.artresearch.net/resource/fr/Work_depicted_by_Photo> ?photo.
                                ?photo crm:P129i_is_subject_of <{{bindings.0.fullsizeImages.value}}>.
                                <{{bindings.0.fullsizeImages.value}}> crm:P2_has_type <http://iiif.io/api/image>.
                                BIND(REPLACE(STR("{{bindings.0.fullsizeImages.value}}"), "full/!700,700", "full/full") AS ?fotoIndexId).
                                BIND(REPLACE(STR(REPLACE(STR(?fotoIndexId), "/full/full/0/*", "")), "(^.*)\\/(.*)$", "$2") AS ?idWithDefaultNative)    BIND(REPLACE(?idWithDefaultNative,"default.jpg","") AS ?idWithNative).
                                BIND(REPLACE(?idWithNative,"native.jpg","") AS ?imageID).
                                '
                    iiif-server-url="{{bindings.0.iiifServer.value}}"
                  >
                  </rs-iiif-mirador>
                </div>
                <div style="width: 50vw; height: 86vh">
                  <rs-iiif-mirador
                    id="versoMirador"
                    image-or-region="[[this]]"
                    image-id-pattern='
                                BIND("image" AS ?type). BIND(?subject AS ?imageIRI). 
                                ?subject <https://pharos.artresearch.net/resource/fr/Work_depicted_by_Photo> ?photo.
                                ?photo crm:P129i_is_subject_of <{{bindings.1.fullsizeImages.value}}>.
                                <{{bindings.1.fullsizeImages.value}}> crm:P2_has_type <http://iiif.io/api/image>.
                                BIND(REPLACE(STR("{{bindings.1.fullsizeImages.value}}"), "full/!700,700", "full/full") AS ?fotoIndexId).
                                BIND(REPLACE(STR(REPLACE(STR(?fotoIndexId), "/full/full/0/*", "")), "(^.*)\\/(.*)$", "$2") AS ?idWithDefaultNative)
                                BIND(REPLACE(?idWithDefaultNative,"default.jpg","") AS ?idWithNative).
                                BIND(REPLACE(?idWithNative,"native.jpg","") AS ?imageID).
                                '
                    iiif-server-url="{{bindings.0.iiifServer.value}}"
                  >
                  </rs-iiif-mirador>
                </div>
              </div>
              {{/ifCond}}
            </div>
            {{else}}
            <img
              style="
                width: 100%;
                height: 100%;
                object-fit: contain;
              "
              src="{{bindings.0.fullsizeImages.value}}"
            />
            {{/ifCond}}
          </template>
        </semantic-query>
      </mp-overlay-dialog-content>
    </mp-overlay-dialog>
  </template>
</mp-event-target-template-render>
<div class="summary-image-thumbs">
  {{#each bindings}}
  <semantic-query
    query='
   SELECT DISTINCT ?imgURL WHERE{ 
      BIND(({{image}}) as ?imgURL)
      FILTER NOT EXISTS { 
        ?imgURL crm:P2_has_type ?type.
        ?type rdfs:label "verso"
      }
    } '
    template="{{> onlyRectos}}"
  >
    <template id="onlyRectos">
      <mp-event-trigger
        id="event-trigger"
        type="Component.TemplateUpdate"
        data='{"imgURL":"{{imgURL.value}}"}'
        targets='["event-target"]'
      >
        <img
          class="object-representations__image--rep smallThumbsSingle"
          src="{{imgURL.value}}"
        />
      </mp-event-trigger>
    </template>
  </semantic-query>
  {{/each}}
</div>
</div>